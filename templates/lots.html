{% if lots_plotly %}
<div class="row mb-4">
  <div class="col-12">
    {{ lots_plotly|safe }}
  </div>
</div>
{% endif %}
{% extends 'main.html' %}
{% block content %}
<h2>Parking Lots Management</h2>

<!-- Create Lot Form -->
<form action="{{ url_for('admin.create_lot') }}" method="post" style="margin-bottom: 2em;">
    <h4>Create New Lot</h4>
    <input type="text" name="prime_location_name" placeholder="Prime Location Name" required>
    <input type="text" name="address" placeholder="Address" required>
    <input type="text" name="pin_code" placeholder="Pin Code" required>
    <input type="number" name="price_per_hr" placeholder="Price per Hour" step="0.01" required>
    <input type="number" name="max_spots" placeholder="Max Spots" min="1" required>
    <button type="submit">Create Lot</button>
</form>

{% if lots and lots|length > 0 %}
<table border="1" cellpadding="8" cellspacing="0">
    <thead>
        <tr>
            <th>ID</th>
            <th>Prime Location</th>
            <th>Address</th>
            <th>Pin Code</th>
            <th>Price/hr</th>
            <th>Max Spots</th>
            <th>Available Spots</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for lot in lots %}
        <tr>
            <td>{{ lot.id }}</td>
            <td>{{ lot.prime_location_name }}</td>
            <td>{{ lot.address }}</td>
            <td>{{ lot.pin_code }}</td>
            <td>{{ lot.price_per_hr }}</td>
            <td>{{ lot.max_spots }}</td>
            <td>{{ lot.avl_spots }}</td>
            <td>
                <!-- Edit Lot Form (inline) -->
                <form action="{{ url_for('admin.edit_lot', lot_id=lot.id) }}" method="post" style="display:inline-block;">
                    <input type="text" name="prime_location_name" value="{{ lot.prime_location_name }}" required size="10">
                    <input type="text" name="address" value="{{ lot.address }}" required size="10">
                    <input type="text" name="pin_code" value="{{ lot.pin_code }}" required size="6">
                    <input type="number" name="price_per_hr" value="{{ lot.price_per_hr }}" step="0.01" required size="5">
                    <input type="number" name="max_spots" value="{{ lot.max_spots }}" min="1" required size="3">
                    <button type="submit">Update</button>
                </form>
                <!-- Add Spot -->
                <form action="{{ url_for('admin.add_spot', lot_id=lot.id) }}" method="post" style="display:inline-block;">
                    <button type="submit">Add Spot</button>
                </form>
                <!-- Delete Lot -->
                <form action="{{ url_for('admin.delete_lot', lot_id=lot.id) }}" method="post" style="display:inline-block;" onsubmit="return confirm('Are you sure you want to delete this lot?');">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <i class="bi bi-info-circle"></i>
    No parking lots found. Please create a new lot above.
</div>
{% endif %}

{% endblock %}