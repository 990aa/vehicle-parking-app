{% extends "main.html" %}


{% block content %}
<!-- Admin Dashboard Header/Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4 sticky-top">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#" style="font-size: 1.6rem;">Vehicle Parking App</a>
    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      <li class="nav-item">
        <a class="nav-link{% if request.endpoint == 'admin.admin_dashboard' %} active{% endif %}" href="{{ url_for('admin.admin_dashboard') }}">Dashboard</a>
      </li>
      <li class="nav-item">
        <a class="nav-link{% if request.endpoint == 'admin.lots' %} active{% endif %}" href="{{ url_for('admin.lots') }}">Manage Lots</a>
      </li>
      <li class="nav-item">
        <a class="nav-link{% if request.endpoint == 'admin.admin_users' %} active{% endif %}" href="{{ url_for('admin.admin_users') }}">Users</a>
      </li>
      <li class="nav-item">
        <a class="nav-link{% if request.endpoint == 'admin.revenue' %} active{% endif %}" href="{{ url_for('admin.revenue') }}">Revenue</a>
      </li>
    </ul>
    <a href="{{ url_for('authorisation.logout') }}" class="btn btn-outline-light">Logout</a>
  </div>
</nav>
<div class="page active" id="adminUsers">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Manage Users</h2>
  </div>

  <form method="get" action="{{ url_for('admin.admin_users') }}" class="mb-3">
    <div class="input-group">
      <input type="text" class="form-control" name="q" placeholder="Search..." value="{{ search_query|default('') }}">
      <select class="form-select" name="field" style="max-width: 150px;">
        <option value="all" {% if search_field == 'all' %}selected{% endif %}>All Fields</option>
        <option value="id" {% if search_field == 'id' %}selected{% endif %}>ID</option>
        <option value="username" {% if search_field == 'username' %}selected{% endif %}>Username</option>
        <option value="email" {% if search_field == 'email' %}selected{% endif %}>Email</option>
      </select>
      <button class="btn btn-primary" type="submit">Search</button>
    </div>
  </form>
  <div class="table-responsive">
    <table class="table table-hover align-middle table-bordered">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Created At</th>
          <th>Total Reservations</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if users|length == 0 %}
        <tr>
          <td colspan="7" class="text-center text-muted">No users found.</td>
        </tr>
        {% else %}
        {% for user in users %}
          {% if user.role == 'user' %}
          <tr>
              <td>{{ user.id }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.created_at }}</td>
              <td>{{ user.total_reservations }}</td>
              <td>
                  <a href="{{ url_for('admin.admin_user_activity', user_id=user.id) }}" class="btn btn-sm btn-info">View Activity</a>
                  <form action="{{ url_for('admin.delete_user', user_id=user.id) }}" method="post" style="display:inline-block;" onsubmit="return confirm('Are you sure you want to delete this user?');">
                      <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                  </form>
              </td>
          </tr>
          {% endif %}
        {% endfor %}
        {% endif %}
    </tbody>
    </table>
  </div>
</div>
{# Dead code: I tried to add a modal for editing users, but it broke the table layout #}
{#
<div class="modal" id="editUserModal">(modal content here)</div>
#}
{% endblock %}